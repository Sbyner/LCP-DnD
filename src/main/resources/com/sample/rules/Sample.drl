package com.sample.rules
 
import creatures.*;
import mechanics.*;
 
rule "Roll for initiative"
	salience 9001
	when
        turn : Turn(status == Turn.State.INIT)
        c : Creature(initiative == -9001)
    then
    	c.setInitiative(Utils.roll("1d20", c.getInitiativeAdvantage())+c.getInitiativeBonus());
        System.out.println( "Initiative: " + c.getName() );
        update( c );
        
end

rule "FIGHT START"
salience 9000
	when
		turn : Turn(status == Turn.State.INIT)
	then
		System.out.println("Gabibbo");
		turn.setStatus(Turn.State.FIGHT);
		update(turn);
end

rule "START OF TURN"
	salience Math.min(8800 + c.getInitiative(),8899)
	when
		turn : Turn(status == Turn.State.FIGHT)
		act : Action()
		c : Creature(name == act.creatureName)
	then
	//TODO start of turn effects
	System.out.println(c.getName()+": Start of turn");
end

rule "ATTACK"
salience Math.min(8700 + c.getInitiative(),8799)
	activation-group "ACTION"
	when
		turn : Turn(status == Turn.State.FIGHT)
		act : Action(type == Action.Type.ATTACK)
		c : Creature(name == act.creatureName)
		
	then
		//TODO attack
		System.out.println(c.getName()+": Attack");
		c.setFought(true);
end

rule "CAST"
salience Math.min(8700 + c.getInitiative(),8799)
	activation-group "ACTION"
	when
		turn : Turn(status == Turn.State.FIGHT)
		act : Action(type == Action.Type.CAST)
		c : Creature(name == act.creatureName)
		
	then
		//TODO cast
		System.out.println(c.getName()+": Cast");
		c.setFought(true);
end

rule "DODGE"
salience Math.min(8700 + c.getInitiative(),8799)
	activation-group "ACTION"
	when
		turn : Turn(status == Turn.State.FIGHT)
		act : Action(type == Action.Type.DODGE)
		c : Creature(name == act.creatureName)
		
	then
		//TODO dodge
		System.out.println(c.getName()+": Cast");
		c.setFought(true);
end

rule "HELP"
salience Math.min(8700 + c.getInitiative(),8799)
	activation-group "ACTION"
	when
		turn : Turn(status == Turn.State.FIGHT)
		act : Action(type == Action.Type.HELP)
		c : Creature(name == act.creatureName)
		
	then
		//TODO help
		System.out.println(c.getName()+": Cast");
		c.setFought(true);
end

rule "HIDE"
salience Math.min(8700 + c.getInitiative(),8799)
	activation-group "ACTION"
	when
		turn : Turn(status == Turn.State.FIGHT)
		act : Action(type == Action.Type.HIDE)
		c : Creature(name == act.creatureName)
		
	then
		//TODO hide
		System.out.println(c.getName()+": Cast");
		c.setFought(true);
end

query "getCreatures"
	$result: Creature()
end



